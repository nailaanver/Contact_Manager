{% extends 'master.html' %}
{% load static %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<header>
    <div class="logosec">
        <div class="logo">Admin Dashboard</div>
        <h2 class="welcome-admin">Welcome, {{ user.username }}</h2>
    </div>

    <div class="searchbar">
        <input type="text" placeholder="Search" />
        <div class="searchbtn"></div>
    </div>

    <div class="message">
        <div class="circle"></div>
        <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210183322/8.png" class="icn" alt="" />
        <div class="dp">
            <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210180014/profile-removebg-preview.png"
                class="dpicn" alt="dp" />
        </div>
    </div>
</header>

<div class="main-container">
    <div class="navcontainer">
        <nav class="nav">
            <div class="nav-upper-options">

                <div class="nav-option option1 active" data-page="{% url 'dashboard_content' %}">
                    <i class="fas fa-tachometer-alt"></i>
                    <h3>Dashboard</h3>
                </div>

                <div class="nav-option option2" data-page="{% url 'manage_users' %}">
                    <i class="fas fa-user-cog"></i>
                    <h3>Manage Users</h3>
                </div>

                <div class="nav-option option3" data-page="{% url 'manage_contact' %}">
                    <i class="fa fa-users"></i>
                    <h3>Manage Contact</h3>
                </div>

                <!-- ✅ Logout should be a link, not a div -->
                <a href="{% url 'logout' %}" class="nav-option option4">
                    <i class="fa fa-sign-out-alt"></i>
                    <h3>Log Out</h3>
                </a>
            </div>
        </nav>
    </div>

    <div class="main" id="main-content">
        <!-- Dynamic content loads here -->
    </div>
</div>

<!-- ================== JS Script ================== -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const mainContent = document.getElementById('main-content');
    const params = new URLSearchParams(window.location.search);
    const section = params.get('section');
    const message = params.get('msg');

    // ✅ Show success message if exists
    if (message) {
        const alertBox = document.createElement('div');
        alertBox.classList.add('alert-success');
        alertBox.textContent = decodeURIComponent(message);
        document.body.prepend(alertBox);
        setTimeout(() => alertBox.remove(), 3000);
    }

    // ✅ Decide which section to show first
    let defaultPageUrl = "{% url 'dashboard_content' %}";
    if (section === 'manage_contact') {
        defaultPageUrl = "{% url 'manage_contact' %}";
        setActiveOption('option3');
    } else if (section === 'manage_users') {
        defaultPageUrl = "{% url 'manage_users' %}";
        setActiveOption('option2');
    } else {
        setActiveOption('option1');
    }

    // ✅ Load the correct section
    fetch(defaultPageUrl)
        .then(response => response.text())
        .then(html => mainContent.innerHTML = html)
        .catch(err => console.error('Error loading content:', err));

    // ✅ Sidebar click handling
    document.querySelectorAll('.nav-option').forEach(item => {
        item.addEventListener('click', function(e) {
            // Don't block logout link
            if (this.classList.contains('option4')) return;

            e.preventDefault();
            const pageUrl = this.getAttribute('data-page');
            if (!pageUrl) return;

            document.querySelectorAll('.nav-option').forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');

            fetch(pageUrl)
                .then(response => response.text())
                .then(html => mainContent.innerHTML = html)
                .catch(err => console.error('Error loading page:', err));
        });
    });

    // Helper for active state
    function setActiveOption(className) {
        document.querySelectorAll('.nav-option').forEach(opt => opt.classList.remove('active'));
        const target = document.querySelector('.' + className);
        if (target) target.classList.add('active');
    }
});
</script>

<!-- ✅ Styling -->
<style>
.nav-option.active {
    background-color: #007bff;
    color: white;
    border-radius: 8px;
}
.alert-success {
    background-color: #4CAF50;
    color: white;
    padding: 10px;
    text-align: center;
    margin: 10px;
    border-radius: 6px;
    font-weight: bold;
}
</style>
{% endblock %}
